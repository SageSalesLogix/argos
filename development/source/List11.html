<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">define('crm/Views/History/List', ['exports', 'module', 'dojo/_base/lang', 'dojo/_base/declare', 'dojo/string', '../../Format', 'argos/Convert', '../../Action', 'argos/List', '../_RightDrawerListMixin', '../_MetricListMixin', '../_CardLayoutListMixin', 'argos/I18n'], function (exports, module, _dojo_baseLang, _dojo_baseDeclare, _dojoString, _Format, _argosConvert, _Action, _argosList, _RightDrawerListMixin2, _MetricListMixin2, _CardLayoutListMixin2, _argosI18n) {
  function _interopRequireDefault(obj) { return obj &amp;&amp; obj.__esModule ? obj : { 'default': obj }; }

  var _lang = _interopRequireDefault(_dojo_baseLang);

  var _declare = _interopRequireDefault(_dojo_baseDeclare);

  var _string = _interopRequireDefault(_dojoString);

  var _format = _interopRequireDefault(_Format);

  var _convert = _interopRequireDefault(_argosConvert);

  var _action = _interopRequireDefault(_Action);

  var _List = _interopRequireDefault(_argosList);

  var _RightDrawerListMixin3 = _interopRequireDefault(_RightDrawerListMixin2);

  var _MetricListMixin3 = _interopRequireDefault(_MetricListMixin2);

  var _CardLayoutListMixin3 = _interopRequireDefault(_CardLayoutListMixin2);

  var _getResource = _interopRequireDefault(_argosI18n);

  var resource = (0, _getResource['default'])('historyList');

<span id='crm-Views-History-List'>  /**
</span>   * @class crm.Views.History.List
   *
   * @extends argos.List
   * @mixins crm.Views._RightDrawerListMixin
   * @mixins crm.Views._MetricListMixin
   * @mixins crm.Views._GroupListMixin
   * @mixins crm.Views._CardLayoutListMixin
   *
   * @requires argos.Convert
   *
   * @requires crm.Format
   * @requires crm.Action
   *
   * @requires moment
   */
  var __class = (0, _declare['default'])('crm.Views.History.List', [_List['default'], _RightDrawerListMixin3['default'], _MetricListMixin3['default'], _CardLayoutListMixin3['default']], {
    // Templates
    itemTemplate: new Simplate(['&lt;h3&gt;', '{% if ($.Type === &quot;atNote&quot;) { %}', '{%: $$.formatDate($.ModifyDate) %}', '{% } else { %}', '{%: $$.formatDate($.CompletedDate) %}', '{% } %}', '&lt;/h3&gt;', '&lt;h4&gt;{%= $$.nameTemplate.apply($) %}&lt;/h4&gt;', '{% if($.Description) { %}', '&lt;h4&gt;{%: $$.regardingText + $.Description %}&lt;/h4&gt;', '{% } %}', '&lt;div class=&quot;note-text-item&quot;&gt;', '&lt;div class=&quot;note-text-wrap&quot;&gt;', '{%: $.Notes %}', '&lt;/div&gt;', '&lt;/div&gt;']),
    nameTemplate: new Simplate(['{% if ($.LeadName &amp;&amp; $.AccountName) { %}', '{%: $.LeadName %} | {%: $.AccountName %}', '{% } else if ($.LeadName) { %}', '{%: $.LeadName %}', '{% } else if ($.ContactName &amp;&amp; $.AccountName) { %}', '{%: $.ContactName %} | {%: $.AccountName %}', '{% } else if ($.ContactName) { %}', '{%: $.ContactName %}', '{% } else { %}', '{%: $.AccountName %}', '{% } %}']),

    // Localization
    hourMinuteFormatText: resource.hourMinuteFormatText,
    dateFormatText: resource.dateFormatText,
    titleText: resource.titleText,
    viewAccountActionText: resource.viewAccountActionText,
    viewOpportunityActionText: resource.viewOpportunityActionText,
    viewContactActionText: resource.viewContactActionText,
    addAttachmentActionText: resource.addAttachmentActionText,
    regardingText: resource.regardingText,
    activityTypeText: {
      'atToDo': resource.toDo,
      'atPhoneCall': resource.phoneCall,
      'atAppointment': resource.meeting,
      'atLiterature': resource.literature,
      'atPersonal': resource.personal,
      'atQuestion': resource.question,
      'atEMail': resource.email
    },
    hashTagQueriesText: {
      'my-history': resource.myHistoryHash,
      'note': resource.noteHash,
      'phonecall': resource.phoneCallHash,
      'meeting': resource.meetingHash,
      'personal': resource.personalHash,
      'email': resource.emailHash
    },

    // View Properties
    detailView: 'history_detail',
    itemIconClass: 'fa fa-archive fa-2x',
    id: 'history_list',
    security: null, // 'Entities/History/View',
    existsRE: /^[\w]{12}$/,
    insertView: 'history_edit',
    queryOrderBy: 'CompletedDate desc',
    querySelect: ['AccountName', 'ContactName', 'LeadName', 'CompletedDate', 'Description', 'StartDate', 'TimeLess', 'Type', 'LeadId', 'OpportunityId', 'OpportunityName', 'AccountId', 'ContactId', 'TicketId', 'ModifyDate', 'Notes'],
    queryWhere: 'Type ne &quot;atDatabaseChange&quot;',
    resourceKind: 'history',
    entityName: 'History',
    hashTagQueries: {
      'my-history': function myHistory() {
        return 'UserId eq &quot;' + App.context.user.$key + '&quot;';
      },
      'note': 'Type eq &quot;atNote&quot;',
      'phonecall': 'Type eq &quot;atPhoneCall&quot;',
      'meeting': 'Type eq &quot;atAppointment&quot;',
      'personal': 'Type eq &quot;atPersonal&quot;',
      'email': 'Type eq &quot;atEMail&quot;'
    },
    activityIndicatorIconByType: {
      'atToDo': 'fa fa-list-ul fa-2x',
      'atPhoneCall': 'fa fa-phone fa-2x',
      'atAppointment': 'fa fa-calendar-o fa-2x',
      'atLiterature': 'fa fa-book fa-2x',
      'atPersonal': 'fa fa-check-square-o fa-2x',
      'atQuestion': 'fa fa-question-circle fa-2x',
      'atNote': 'fa fa-file-text-o fa-2x',
      'atEMail': 'fa fa-envelope fa-2x'
    },
    allowSelection: true,
    enableActions: true,

    createActionLayout: function createActionLayout() {
      return this.actions || (this.actions = [{
        id: 'viewAccount',
        label: this.viewAccountActionText,
        enabled: _action['default'].hasProperty.bindDelegate(this, 'AccountId'),
        fn: _action['default'].navigateToEntity.bindDelegate(this, {
          view: 'account_detail',
          keyProperty: 'AccountId',
          textProperty: 'AccountName'
        })
      }, {
        id: 'viewOpportunity',
        label: this.viewOpportunityActionText,
        enabled: _action['default'].hasProperty.bindDelegate(this, 'OpportunityId'),
        fn: _action['default'].navigateToEntity.bindDelegate(this, {
          view: 'opportunity_detail',
          keyProperty: 'OpportunityId',
          textProperty: 'OpportunityName'
        })
      }, {
        id: 'viewContact',
        label: this.viewContactActionText,
        action: 'navigateToContactOrLead',
        enabled: this.hasContactOrLead
      }, {
        id: 'addAttachment',
        cls: 'fa fa-paperclip fa-2x',
        label: this.addAttachmentActionText,
        fn: _action['default'].addAttachment.bindDelegate(this)
      }]);
    },
    hasContactOrLead: function hasContactOrLead(theAction, selection) {
      return selection.data.ContactId || selection.data.LeadId;
    },
    navigateToContactOrLead: function navigateToContactOrLead(theAction, selection) {
      var entity = this.resolveContactOrLeadEntity(selection.data);
      var viewId = undefined;
      var options = undefined;

      switch (entity) {
        case 'Contact':
          viewId = 'contact_detail';
          options = {
            key: selection.data.ContactId,
            descriptor: selection.data.ContactName
          };
          break;
        case 'Lead':
          viewId = 'lead_detail';
          options = {
            key: selection.data.LeadId,
            descriptor: selection.data.LeadName
          };
          break;
        default:
      }

      var view = App.getView(viewId);

      if (view &amp;&amp; options) {
        view.show(options);
      }
    },
    resolveContactOrLeadEntity: function resolveContactOrLeadEntity(entry) {
      var exists = this.existsRE;

      if (entry) {
        if (exists.test(entry.LeadId)) {
          return 'Lead';
        }
        if (exists.test(entry.ContactId)) {
          return 'Contact';
        }
      }
    },
    formatDate: function formatDate(date) {
      var startDate = moment(_convert['default'].toDateFromString(date));
      var nextDate = startDate.clone().add({
        hours: 24
      });
      var fmt = this.dateFormatText;

      if (startDate.valueOf() &lt; nextDate.valueOf() &amp;&amp; startDate.valueOf() &gt; moment().startOf('day').valueOf()) {
        fmt = this.hourMinuteFormatText;
      }

      return _format['default'].date(startDate.toDate(), fmt);
    },
    formatSearchQuery: function formatSearchQuery(searchQuery) {
      return _string['default'].substitute('upper(Description) like &quot;%${0}%&quot;', [this.escapeSearchQuery(searchQuery.toUpperCase())]);
    },
    createIndicatorLayout: function createIndicatorLayout() {
      return this.itemIndicators || (this.itemIndicators = [{
        id: 'touched',
        cls: 'fa fa-hand-o-up fa-lg',
        label: 'Touched',
        onApply: function onApply(entry, parent) {
          this.isEnabled = parent.hasBeenTouched(entry);
        }
      }]);
    },
    getItemIconClass: function getItemIconClass(entry) {
      var type = entry &amp;&amp; entry.Type;
      return this._getItemIconClass(type);
    },
    _getItemIconClass: function _getItemIconClass(type) {
      var cls = this.activityIndicatorIconByType[type];
      if (!cls) {
        cls = this.itemIconClass;
      }

      return cls;
    },
    init: function init() {
      this.inherited(arguments);
    }
  });

  _lang['default'].setObject('Mobile.SalesLogix.Views.History.List', __class);
  module.exports = __class;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9WaWV3cy9IaXN0b3J5L0xpc3QuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVlBLE1BQU0sUUFBUSxHQUFHLDZCQUFZLGFBQWEsQ0FBQyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFrQjVDLE1BQU0sT0FBTyxHQUFHLHlCQUFRLHdCQUF3QixFQUFFLHFIQUFxRSxFQUFFOztBQUV2SCxnQkFBWSxFQUFFLElBQUksUUFBUSxDQUFDLENBQ3pCLE1BQU0sRUFDTixrQ0FBa0MsRUFDbEMsb0NBQW9DLEVBQ3BDLGdCQUFnQixFQUNoQix1Q0FBdUMsRUFDdkMsU0FBUyxFQUNULE9BQU8sRUFDUCwwQ0FBMEMsRUFDMUMsMkJBQTJCLEVBQzNCLGtEQUFrRCxFQUNsRCxTQUFTLEVBQ1QsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5QixnQkFBZ0IsRUFDaEIsUUFBUSxFQUNSLFFBQVEsQ0FDVCxDQUFDO0FBQ0YsZ0JBQVksRUFBRSxJQUFJLFFBQVEsQ0FBQyxDQUN6QiwwQ0FBMEMsRUFDMUMsMENBQTBDLEVBQzFDLGdDQUFnQyxFQUNoQyxtQkFBbUIsRUFDbkIsb0RBQW9ELEVBQ3BELDZDQUE2QyxFQUM3QyxtQ0FBbUMsRUFDbkMsc0JBQXNCLEVBQ3RCLGdCQUFnQixFQUNoQixzQkFBc0IsRUFDdEIsU0FBUyxDQUNWLENBQUM7OztBQUdGLHdCQUFvQixFQUFFLFFBQVEsQ0FBQyxvQkFBb0I7QUFDbkQsa0JBQWMsRUFBRSxRQUFRLENBQUMsY0FBYztBQUN2QyxhQUFTLEVBQUUsUUFBUSxDQUFDLFNBQVM7QUFDN0IseUJBQXFCLEVBQUUsUUFBUSxDQUFDLHFCQUFxQjtBQUNyRCw2QkFBeUIsRUFBRSxRQUFRLENBQUMseUJBQXlCO0FBQzdELHlCQUFxQixFQUFFLFFBQVEsQ0FBQyxxQkFBcUI7QUFDckQsMkJBQXVCLEVBQUUsUUFBUSxDQUFDLHVCQUF1QjtBQUN6RCxpQkFBYSxFQUFFLFFBQVEsQ0FBQyxhQUFhO0FB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SSxFQUFFO0FBQ2xELFVBQUksR0FBRyxHQUFHLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNqRCxVQUFJLENBQUMsR0FBRyxFQUFFO0FBQ1IsV0FBRyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUM7T0FDMUI7O0FBRUQsYUFBTyxHQUFHLENBQUM7S0FDWjtBQUNELFFBQUksRUFBRSxTQUFTLElBQUksR0FBRztBQUNwQixVQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0tBQzNCO0dBQ0YsQ0FBQyxDQUFDOztBQUVILG1CQUFLLFNBQVMsQ0FBQyxzQ0FBc0MsRUFBRSxPQUFPLENBQUMsQ0FBQzttQkFDakQsT0FBTyIsImZpbGUiOiJzcmMvVmlld3MvSGlzdG9yeS9MaXN0LmpzIiwic291cmNlUm9vdCI6InNyYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsYW5nIGZyb20gJ2Rvam8vX2Jhc2UvbGFuZyc7XHJcbmltcG9ydCBkZWNsYXJlIGZyb20gJ2Rvam8vX2Jhc2UvZGVjbGFyZSc7XHJcbmltcG9ydCBzdHJpbmcgZnJvbSAnZG9qby9zdHJpbmcnO1xyXG5pbXBvcnQgZm9ybWF0IGZyb20gJy4uLy4uL0Zvcm1hdCc7XHJcbmltcG9ydCBjb252ZXJ0IGZyb20gJ2FyZ29zL0NvbnZlcnQnO1xyXG5pbXBvcnQgYWN0aW9uIGZyb20gJy4uLy4uL0FjdGlvbic7XHJcbmltcG9ydCBMaXN0IGZyb20gJ2FyZ29zL0xpc3QnO1xyXG5pbXBvcnQgX1JpZ2h0RHJhd2VyTGlzdE1peGluIGZyb20gJy4uL19SaWdodERyYXdlckxpc3RNaXhpbic7XHJcbmltcG9ydCBfTWV0cmljTGlzdE1peGluIGZyb20gJy4uL19NZXRyaWNMaXN0TWl4aW4nO1xyXG5pbXBvcnQgX0NhcmRMYXlvdXRMaXN0TWl4aW4gZnJvbSAnLi4vX0NhcmRMYXlvdXRMaXN0TWl4aW4nO1xyXG5pbXBvcnQgZ2V0UmVzb3VyY2UgZnJvbSAnYXJnb3MvSTE4bic7XHJcblxyXG5jb25zdCByZXNvdXJjZSA9IGdldFJlc291cmNlKCdoaXN0b3J5TGlzdCcpO1xyXG5cclxuLyoqXHJcbiAqIEBjbGFzcyBjcm0uVmlld3MuSGlzdG9yeS5MaXN0XHJcbiAqXHJcbiAqIEBleHRlbmRzIGFyZ29zLkxpc3RcclxuICogQG1peGlucyBjcm0uVmlld3MuX1JpZ2h0RHJhd2VyTGlzdE1peGluXHJcbiAqIEBtaXhpbnMgY3JtLlZpZXdzLl9NZXRyaWNMaXN0TWl4aW5cclxuICogQG1peGlucyBjcm0uVmlld3MuX0dyb3VwTGlzdE1peGluXHJcbiAqIEBtaXhpbnMgY3JtLlZpZXdzLl9DYXJkTGF5b3V0TGlzdE1peGluXHJcbiAqXHJcbiAqIEByZXF1aXJlcyBhcmdvcy5Db252ZXJ0XHJcbiAqXHJcbiAqIEByZXF1aXJlcyBjcm0uRm9ybWF0XHJcbiAqIEByZXF1aXJlcyBjcm0uQWN0aW9uXHJcbiAqXHJcbiAqIEByZXF1aXJlcyBtb21lbnRcclxuICovXHJcbmNvbnN0IF9fY2xhc3MgPSBkZWNsYXJlKCdjcm0uVmlld3MuSGlzdG9yeS5MaXN0JywgW0xpc3QsIF9SaWdodERyYXdlckxpc3RNaXhpbiwgX01ldHJpY0xpc3RNaXhpbiwgX0NhcmRMYXlvdXRMaXN0TWl4aW5dLCB7XHJcbiAgLy8gVGVtcGxhdGVzXHJcbiAgaXRlbVRlbXBsYXRlOiBuZXcgU2ltcGxhdGUoW1xyXG4gICAgJzxoMz4nLFxyXG4gICAgJ3slIGlmICgkLlR5cGUgPT09IFwiYXROb3RlXCIpIHsgJX0nLFxyXG4gICAgJ3slOiAkJC5mb3JtYXREYXRlKCQuTW9kaWZ5RGF0ZSkgJX0nLFxyXG4gICAgJ3slIH0gZWxzZSB7ICV9JyxcclxuICAgICd7JTogJCQuZm9ybWF0RGF0ZSgkLkNvbXBsZXRlZERhdGUpICV9JyxcclxuICAgICd7JSB9ICV9JyxcclxuICAgICc8L2gzPicsXHJcbiAgICAnPGg0PnslPSAkJC5uYW1lVGVtcGxhdGUuYXBwbHkoJCkgJX08L2g0PicsXHJcbiAgICAneyUgaWYoJC5EZXNjcmlwdGlvbikgeyAlfScsXHJcbiAgICAnPGg0PnslOiAkJC5yZWdhcmRpbmdUZXh0ICsgJC5EZXNjcmlwdGlvbiAlfTwvaDQ+JyxcclxuICAgICd7JSB9ICV9JyxcclxuICAgICc8ZGl2IGNsYXNzPVwibm90ZS10ZXh0LWl0ZW1cIj4nLFxyXG4gICAgJzxkaXYgY2xhc3M9XCJub3RlLXRleHQtd3JhcFwiPicsXHJcbiAgICAneyU6ICQuTm90ZXMgJX0nLFxyXG4gICAgJzwvZGl2PicsXHJcbiAgICAnPC9kaXY+JyxcclxuICBdKSxcclxuICBuYW1lVGVtcGxhdGU6IG5ldyBTaW1wbGF0ZShbXHJcbiAgICAneyUgaWYgKCQuTGVhZE5hbWUgJiYgJC5BY2NvdW50TmFtZSkgeyAlfScsXHJcbiAgICAneyU6ICQuTGVhZE5hbWUgJX0gfCB7JTogJC5BY2NvdW50TmFtZSAlfScsXHJcbiAgICAneyUgfSBlbHNlIGlmICgkLkxlYWROYW1lKSB7ICV9JyxcclxuICAgICd7JTogJC5MZWFkTmFtZSAlfScsXHJcbiAgICAneyUgfSBlbHNlIGlmICgkLkNvbnRhY3ROYW1lICYmICQuQWNjb3VudE5hbWUpIHsgJX0nLFxyXG4gICAgJ3slOiAkLkNvbnRhY3ROYW1lICV9IHwgeyU6ICQuQWNjb3VudE5hbWUgJX0nLFxyXG4gICAgJ3slIH0gZWxzZSBpZiAoJC5Db250YWN0TmFtZSkgeyAlfScsXHJcbiAgICAneyU6ICQuQ29udGFjdE5hbWUgJX0nLFxyXG4gICAgJ3slIH0gZWxzZSB7ICV9JyxcclxuICAgICd7JTogJC5BY2NvdW50TmFtZSAlfScsXHJcbiAgICAneyUgfSAlfScsXHJcbiAgXSksXHJcblxyXG4gIC8vIExvY2FsaXphdGlvblxyXG4gIGhvdXJNaW51dGVGb3JtYXRUZXh0OiByZXNvdXJjZS5ob3VyTWludXRlRm9ybWF0VGV4dCxcclxuICBkYXRlRm9ybWF0VGV4dDogcmVzb3VyY2UuZGF0ZUZvcm1hdFRleHQsXHJcbiAgdGl0bGVUZXh0OiByZXNvdXJjZS50aXRsZVRleHQsXHJcbiAgdmlld0FjY291bnRBY3Rpb25UZXh0OiByZXNvdXJjZS52aWV3QWNjb3VudEFjdGlvblRleHQsXHJcbiAgdmlld09wcG9ydHVuaXR5QWN0aW9uVGV4dDogcmVzb3VyY2Uudmlld09wcG9ydHVuaXR5QWN0aW9uVGV4dCxcclxuICB2aWV3Q29udGFjdEFjdGlvblRleHQ6IHJlc291cmNlLnZpZXdDb250YWN0QWN0aW9uVGV4dCxcclxuICBhZGRBdHRhY2htZW50QWN0aW9uVGV4dDogcmVzb3VyY2UuYWRkQXR0YWNobWVudEFjdGlvblRleHQsXHJcbiAgcmVnYXJkaW5nVGV4dDogcmVzb3VyY2UucmVnYXJkaW5nVGV4dCxcclxuICBhY3Rpdml0eVR5cGVUZXh0OiB7XHJcbiAgICAnYXRUb0RvJzogcmVzb3VyY2UudG9EbyxcclxuICAgICdhdFBob25lQ2FsbCc6IHJlc291cmNlLnBob25lQ2FsbCxcclxuICAgICdhdEFwcG9pbnRtZW50JzogcmVzb3VyY2UubWVldGluZyxcclxuICAgICdhdExpdGVyYXR1cmUnOiByZXNvdXJjZS5saXRlcmF0dXJlLFxyXG4gICAgJ2F0UGVyc29uYWwnOiByZXNvdXJjZS5wZXJzb25hbCxcclxuICAgICdhdFF1ZXN0aW9uJzogcmVzb3VyY2UucXVlc3Rpb24sXHJcbiAgICAnYXRFTWFpbCc6IHJlc291cmNlLmVtYWlsLFxyXG4gIH0sXHJcbiAgaGFzaFRhZ1F1ZXJpZXNUZXh0OiB7XHJcbiAgICAnbXktaGlzdG9yeSc6IHJlc291cmNlLm15SGlzdG9yeUhhc2gsXHJcbiAgICAnbm90ZSc6IHJlc291cmNlLm5vdGVIYXNoLFxyXG4gICAgJ3Bob25lY2FsbCc6IHJlc291cmNlLnBob25lQ2FsbEhhc2gsXHJcbiAgICAnbWVldGluZyc6IHJlc291cmNlLm1lZXRpbmdIYXNoLFxyXG4gICAgJ3BlcnNvbmFsJzogcmVzb3VyY2UucGVyc29uYWxIYXNoLFxyXG4gICAgJ2VtYWlsJzogcmVzb3VyY2UuZW1haWxIYXNoLFxyXG4gIH0sXHJcblxyXG4gIC8vIFZpZXcgUHJvcGVydGllc1xyXG4gIGRldGFpbFZpZXc6ICdoaXN0b3J5X2RldGFpbCcsXHJcbiAgaXRlbUljb25DbGFzczogJ2ZhIGZhLWFyY2hpdmUgZmEtMngnLFxyXG4gIGlkOiAnaGlzdG9yeV9saXN0JyxcclxuICBzZWN1cml0eTogbnVsbCwgLy8gJ0VudGl0aWVzL0hpc3RvcnkvVmlldycsXHJcbiAgZXhpc3RzUkU6IC9eW1xcd117MTJ9JC8sXHJcbiAgaW5zZXJ0VmlldzogJ2hpc3RvcnlfZWRpdCcsXHJcbiAgcXVlcnlPcmRlckJ5OiAnQ29tcGxldGVkRGF0ZSBkZXNjJyxcclxuICBxdWVyeVNlbGVjdDogW1xyXG4gICAgJ0FjY291bnROYW1lJyxcclxuICAgICdDb250YWN0TmFtZScsXHJcbiAgICAnTGVhZE5hbWUnLFxyXG4gICAgJ0NvbXBsZXRlZERhdGUnLFxyXG4gICAgJ0Rlc2NyaXB0aW9uJyxcclxuICAgICdTdGFydERhdGUnLFxyXG4gICAgJ1RpbWVMZXNzJyxcclxuICAgICdUeXBlJyxcclxuICAgICdMZWFkSWQnLFxyXG4gICAgJ09wcG9ydHVuaXR5SWQnLFxyXG4gICAgJ09wcG9ydHVuaXR5TmFtZScsXHJcbiAgICAnQWNjb3VudElkJyxcclxuICAgICdDb250YWN0SWQnLFxyXG4gICAgJ1RpY2tldElkJyxcclxuICAgICdNb2RpZnlEYXRlJyxcclxuICAgICdOb3RlcycsXHJcblxyXG4gIF0sXHJcbiAgcXVlcnlXaGVyZTogJ1R5cGUgbmUgXCJhdERhdGFiYXNlQ2hhbmdlXCInLFxyXG4gIHJlc291cmNlS2luZDogJ2hpc3RvcnknLFxyXG4gIGVudGl0eU5hbWU6ICdIaXN0b3J5JyxcclxuICBoYXNoVGFnUXVlcmllczoge1xyXG4gICAgJ215LWhpc3RvcnknOiBmdW5jdGlvbiBteUhpc3RvcnkoKSB7XHJcbiAgICAgIHJldHVybiAnVXNlcklkIGVxIFwiJyArIEFwcC5jb250ZXh0LnVzZXIuJGtleSArICdcIic7XHJcbiAgICB9LFxyXG4gICAgJ25vdGUnOiAnVHlwZSBlcSBcImF0Tm90ZVwiJyxcclxuICAgICdwaG9uZWNhbGwnOiAnVHlwZSBlcSBcImF0UGhvbmVDYWxsXCInLFxyXG4gICAgJ21lZXRpbmcnOiAnVHlwZSBlcSBcImF0QXBwb2ludG1lbnRcIicsXHJcbiAgICAncGVyc29uYWwnOiAnVHlwZSBlcSBcImF0UGVyc29uYWxcIicsXHJcbiAgICAnZW1haWwnOiAnVHlwZSBlcSBcImF0RU1haWxcIicsXHJcbiAgfSxcclxuICBhY3Rpdml0eUluZGljYXRvckljb25CeVR5cGU6IHtcclxuICAgICdhdFRvRG8nOiAnZmEgZmEtbGlzdC11bCBmYS0yeCcsXHJcbiAgICAnYXRQaG9uZUNhbGwnOiAnZmEgZmEtcGhvbmUgZmEtMngnLFxyXG4gICAgJ2F0QXBwb2ludG1lbnQnOiAnZmEgZmEtY2FsZW5kYXItbyBmYS0yeCcsXHJcbiAgICAnYXRMaXRlcmF0dXJlJzogJ2ZhIGZhLWJvb2sgZmEtMngnLFxyXG4gICAgJ2F0UGVyc29uYWwnOiAnZmEgZmEtY2hlY2stc3F1YXJlLW8gZmEtMngnLFxyXG4gICAgJ2F0UXVlc3Rpb24nOiAnZmEgZmEtcXVlc3Rpb24tY2lyY2xlIGZhLTJ4JyxcclxuICAgICdhdE5vdGUnOiAnZmEgZmEtZmlsZS10ZXh0LW8gZmEtMngnLFxyXG4gICAgJ2F0RU1haWwnOiAnZmEgZmEtZW52ZWxvcGUgZmEtMngnLFxyXG4gIH0sXHJcbiAgYWxsb3dTZWxlY3Rpb246IHRydWUsXHJcbiAgZW5hYmxlQWN0aW9uczogdHJ1ZSxcclxuXHJcbiAgY3JlYXRlQWN0aW9uTGF5b3V0OiBmdW5jdGlvbiBjcmVhdGVBY3Rpb25MYXlvdXQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5hY3Rpb25zIHx8ICh0aGlzLmFjdGlvbnMgPSBbe1xyXG4gICAgICBpZDogJ3ZpZXdBY2NvdW50JyxcclxuICAgICAgbGFiZWw6IHRoaXMudmlld0FjY291bnRBY3Rpb25UZXh0LFxyXG4gICAgICBlbmFibGVkOiBhY3Rpb24uaGFzUHJvcGVydHkuYmluZERlbGVnYXRlKHRoaXMsICdBY2NvdW50SWQnKSxcclxuICAgICAgZm46IGFjdGlvbi5uYXZpZ2F0ZVRvRW50aXR5LmJpbmREZWxlZ2F0ZSh0aGlzLCB7XHJcbiAgICAgICAgdmlldzogJ2FjY291bnRfZGV0YWlsJyxcclxuICAgICAgICBrZXlQcm9wZXJ0eTogJ0FjY291bnRJZCcsXHJcbiAgICAgICAgdGV4dFByb3BlcnR5OiAnQWNjb3VudE5hbWUnLFxyXG4gICAgICB9KSxcclxuICAgIH0sIHtcclxuICAgICAgaWQ6ICd2aWV3T3Bwb3J0dW5pdHknLFxyXG4gICAgICBsYWJlbDogdGhpcy52aWV3T3Bwb3J0dW5pdHlBY3Rpb25UZXh0LFxyXG4gICAgICBlbmFibGVkOiBhY3Rpb24uaGFzUHJvcGVydHkuYmluZERlbGVnYXRlKHRoaXMsICdPcHBvcnR1bml0eUlkJyksXHJcbiAgICAgIGZuOiBhY3Rpb24ubmF2aWdhdGVUb0VudGl0eS5iaW5kRGVsZWdhdGUodGhpcywge1xyXG4gICAgICAgIHZpZXc6ICdvcHBvcnR1bml0eV9kZXRhaWwnLFxyXG4gICAgICAgIGtleVByb3BlcnR5OiAnT3Bwb3J0dW5pdHlJZCcsXHJcbiAgICAgICAgdGV4dFByb3BlcnR5OiAnT3Bwb3J0dW5pdHlOYW1lJyxcclxuICAgICAgfSksXHJcbiAgICB9LCB7XHJcbiAgICAgIGlkOiAndmlld0NvbnRhY3QnLFxyXG4gICAgICBsYWJlbDogdGhpcy52aWV3Q29udGFjdEFjdGlvblRleHQsXHJcbiAgICAgIGFjdGlvbjogJ25hdmlnYXRlVG9Db250YWN0T3JMZWFkJyxcclxuICAgICAgZW5hYmxlZDogdGhpcy5oYXNDb250YWN0T3JMZWFkLFxyXG4gICAgfSwge1xyXG4gICAgICBpZDogJ2FkZEF0dGFjaG1lbnQnLFxyXG4gICAgICBjbHM6ICdmYSBmYS1wYXBlcmNsaXAgZmEtMngnLFxyXG4gICAgICBsYWJlbDogdGhpcy5hZGRBdHRhY2htZW50QWN0aW9uVGV4dCxcclxuICAgICAgZm46IGFjdGlvbi5hZGRBdHRhY2htZW50LmJpbmREZWxlZ2F0ZSh0aGlzKSxcclxuICAgIH1dKTtcclxuICB9LFxyXG4gIGhhc0NvbnRhY3RPckxlYWQ6IGZ1bmN0aW9uIGhhc0NvbnRhY3RPckxlYWQodGhlQWN0aW9uLCBzZWxlY3Rpb24pIHtcclxuICAgIHJldHVybiAoc2VsZWN0aW9uLmRhdGEuQ29udGFjdElkKSB8fCAoc2VsZWN0aW9uLmRhdGEuTGVhZElkKTtcclxuICB9LFxyXG4gIG5hdmlnYXRlVG9Db250YWN0T3JMZWFkOiBmdW5jdGlvbiBuYXZpZ2F0ZVRvQ29udGFjdE9yTGVhZCh0aGVBY3Rpb24sIHNlbGVjdGlvbikge1xyXG4gICAgY29uc3QgZW50aXR5ID0gdGhpcy5yZXNvbHZlQ29udGFjdE9yTGVhZEVudGl0eShzZWxlY3Rpb24uZGF0YSk7XHJcbiAgICBsZXQgdmlld0lkO1xyXG4gICAgbGV0IG9wdGlvbnM7XHJcblxyXG4gICAgc3dpdGNoIChlbnRpdHkpIHtcclxuICAgICAgY2FzZSAnQ29udGFjdCc6XHJcbiAgICAgICAgdmlld0lkID0gJ2NvbnRhY3RfZGV0YWlsJztcclxuICAgICAgICBvcHRpb25zID0ge1xyXG4gICAgICAgICAga2V5OiBzZWxlY3Rpb24uZGF0YS5Db250YWN0SWQsXHJcbiAgICAgICAgICBkZXNjcmlwdG9yOiBzZWxlY3Rpb24uZGF0YS5Db250YWN0TmFtZSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdMZWFkJzpcclxuICAgICAgICB2aWV3SWQgPSAnbGVhZF9kZXRhaWwnO1xyXG4gICAgICAgIG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICBrZXk6IHNlbGVjdGlvbi5kYXRhLkxlYWRJZCxcclxuICAgICAgICAgIGRlc2NyaXB0b3I6IHNlbGVjdGlvbi5kYXRhLkxlYWROYW1lLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdmlldyA9IEFwcC5nZXRWaWV3KHZpZXdJZCk7XHJcblxyXG4gICAgaWYgKHZpZXcgJiYgb3B0aW9ucykge1xyXG4gICAgICB2aWV3LnNob3cob3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgfSxcclxuICByZXNvbHZlQ29udGFjdE9yTGVhZEVudGl0eTogZnVuY3Rpb24gcmVzb2x2ZUNvbnRhY3RPckxlYWRFbnRpdHkoZW50cnkpIHtcclxuICAgIGNvbnN0IGV4aXN0cyA9IHRoaXMuZXhpc3RzUkU7XHJcblxyXG4gICAgaWYgKGVudHJ5KSB7XHJcbiAgICAgIGlmIChleGlzdHMudGVzdChlbnRyeS5MZWFkSWQpKSB7XHJcbiAgICAgICAgcmV0dXJuICdMZWFkJztcclxuICAgICAgfVxyXG4gICAgICBpZiAoZXhpc3RzLnRlc3QoZW50cnkuQ29udGFjdElkKSkge1xyXG4gICAgICAgIHJldHVybiAnQ29udGFjdCc7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9LFxyXG4gIGZvcm1hdERhdGU6IGZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSkge1xyXG4gICAgY29uc3Qgc3RhcnREYXRlID0gbW9tZW50KGNvbnZlcnQudG9EYXRlRnJvbVN0cmluZyhkYXRlKSk7XHJcbiAgICBjb25zdCBuZXh0RGF0ZSA9IHN0YXJ0RGF0ZS5jbG9uZSgpLmFkZCh7XHJcbiAgICAgICAgaG91cnM6IDI0LFxyXG4gICAgICB9KTtcclxuICAgIGxldCBmbXQgPSB0aGlzLmRhdGVGb3JtYXRUZXh0O1xyXG5cclxuICAgIGlmIChzdGFydERhdGUudmFsdWVPZigpIDwgbmV4dERhdGUudmFsdWVPZigpICYmIHN0YXJ0RGF0ZS52YWx1ZU9mKCkgPiBtb21lbnQoKS5zdGFydE9mKCdkYXknKS52YWx1ZU9mKCkpIHtcclxuICAgICAgZm10ID0gdGhpcy5ob3VyTWludXRlRm9ybWF0VGV4dDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZm9ybWF0LmRhdGUoc3RhcnREYXRlLnRvRGF0ZSgpLCBmbXQpO1xyXG4gIH0sXHJcbiAgZm9ybWF0U2VhcmNoUXVlcnk6IGZ1bmN0aW9uIGZvcm1hdFNlYXJjaFF1ZXJ5KHNlYXJjaFF1ZXJ5KSB7XHJcbiAgICByZXR1cm4gc3RyaW5nLnN1YnN0aXR1dGUoJ3VwcGVyKERlc2NyaXB0aW9uKSBsaWtlIFwiJSR7MH0lXCInLCBbdGhpcy5lc2NhcGVTZWFyY2hRdWVyeShzZWFyY2hRdWVyeS50b1VwcGVyQ2FzZSgpKV0pO1xyXG4gIH0sXHJcbiAgY3JlYXRlSW5kaWNhdG9yTGF5b3V0OiBmdW5jdGlvbiBjcmVhdGVJbmRpY2F0b3JMYXlvdXQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5pdGVtSW5kaWNhdG9ycyB8fCAodGhpcy5pdGVtSW5kaWNhdG9ycyA9IFt7XHJcbiAgICAgIGlkOiAndG91Y2hlZCcsXHJcbiAgICAgIGNsczogJ2ZhIGZhLWhhbmQtby11cCBmYS1sZycsXHJcbiAgICAgIGxhYmVsOiAnVG91Y2hlZCcsXHJcbiAgICAgIG9uQXBwbHk6IGZ1bmN0aW9uIG9uQXBwbHkoZW50cnksIHBhcmVudCkge1xyXG4gICAgICAgIHRoaXMuaXNFbmFibGVkID0gcGFyZW50Lmhhc0JlZW5Ub3VjaGVkKGVudHJ5KTtcclxuICAgICAgfSxcclxuICAgIH1dKTtcclxuICB9LFxyXG4gIGdldEl0ZW1JY29uQ2xhc3M6IGZ1bmN0aW9uIGdldEl0ZW1JY29uQ2xhc3MoZW50cnkpIHtcclxuICAgIGNvbnN0IHR5cGUgPSBlbnRyeSAmJiBlbnRyeS5UeXBlO1xyXG4gICAgcmV0dXJuIHRoaXMuX2dldEl0ZW1JY29uQ2xhc3ModHlwZSk7XHJcbiAgfSxcclxuICBfZ2V0SXRlbUljb25DbGFzczogZnVuY3Rpb24gX2dldEl0ZW1JY29uQ2xhc3ModHlwZSkge1xyXG4gICAgbGV0IGNscyA9IHRoaXMuYWN0aXZpdHlJbmRpY2F0b3JJY29uQnlUeXBlW3R5cGVdO1xyXG4gICAgaWYgKCFjbHMpIHtcclxuICAgICAgY2xzID0gdGhpcy5pdGVtSWNvbkNsYXNzO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBjbHM7XHJcbiAgfSxcclxuICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgdGhpcy5pbmhlcml0ZWQoYXJndW1lbnRzKTtcclxuICB9LFxyXG59KTtcclxuXHJcbmxhbmcuc2V0T2JqZWN0KCdNb2JpbGUuU2FsZXNMb2dpeC5WaWV3cy5IaXN0b3J5Lkxpc3QnLCBfX2NsYXNzKTtcclxuZXhwb3J0IGRlZmF1bHQgX19jbGFzcztcclxuIl19
</pre>
</body>
</html>
